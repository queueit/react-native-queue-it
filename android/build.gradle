buildscript {
  def kotlin_version = rootProject.ext.has('kotlinVersion') ? rootProject.ext.get('kotlinVersion') : project.properties['QueueIt_kotlinVersion']

  repositories {
    mavenCentral()
    google()
    maven{
      url "https://repo1.maven.org/maven2/"
    }
    maven {
      url "https://maven.google.com"
    }
    mavenLocal()
  }

  dependencies {
    classpath 'com.android.tools.build:gradle:8.3.2'
    classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
  }
}

plugins {
  id 'com.android.library'
  id 'com.facebook.react'
  id 'kotlin-android'
}

def getExtOrDefault(name) {
  return rootProject.ext.has(name) ? rootProject.ext.get(name) : project.properties['QueueIt_' + name]
}

def getExtOrIntegerDefault(name) {
  return rootProject.ext.has(name) ? rootProject.ext.get(name) : (project.properties['QueueIt_' + name]).toInteger()
}

android {
  namespace "com.reactnativequeueit"
  compileSdkVersion getExtOrIntegerDefault('compileSdkVersion')
  buildFeatures {
    prefab true
  }
  defaultConfig {
    minSdkVersion 24
    targetSdkVersion getExtOrIntegerDefault('targetSdkVersion')
    versionCode 1
    versionName "1.0"

    externalNativeBuild {
      cmake {
        cppFlags "-std=c++17"
        arguments "-DANDROID_STL=c++_shared",
                  "-DCMAKE_OBJECT_PATH_MAX=1024",
                  "-DANDROID_SUPPORT_FLEXIBLE_PAGE_SIZES=ON",
                  "-DREACT_NATIVE_DIR=${rootProject.projectDir}/../node_modules/react-native",
                  "-DCODEGEN_DIR=${buildDir}/generated/source/codegen/jni"
      }
    }

    ndk {
      abiFilters "armeabi-v7a", "arm64-v8a", "x86_64"
    }
  }
  buildTypes {
    release {
      minifyEnabled false
    }
  }
  lintOptions {
    disable 'GradleCompatible'
  }
  externalNativeBuild {
    cmake {
      path "src/main/jni/CMakeLists.txt"
    }
  }
  sourceSets {
    main {
      java.srcDirs += "$buildDir/generated/source/codegen/java"
      jniLibs.srcDirs += "$buildDir/generated/source/codegen/jni"
    }
  }
}

def kotlin_version = getExtOrDefault('kotlinVersion')
dependencies {
  implementation "org.jetbrains.kotlin:kotlin-stdlib:$kotlin_version"

  implementation(libs.react.android)
  implementation(libs.fbjni)

  //App dependencies
  implementation('com.queue-it.androidsdk:library:2.0.36')
  implementation('com.android.support:appcompat-v7:28.0.0')
  implementation('com.android.support:design:28.0.0')
}
